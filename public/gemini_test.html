<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Gemini Image Analysis Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .box { border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; border-radius: 8px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="file"] { width: 100%; padding: 8px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        #result { background: #f4f4f4; padding: 15px; border-radius: 4px; white-space: pre-wrap; font-family: monospace; min-height: 100px; }
        img { max-width: 100%; margin-top: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ¤– Gemini ë¹„ì „ ë¶„ì„ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="box">
        <label>API Key (ì—¬ê¸°ì— ìƒˆ í‚¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”):</label>
        <input type="text" id="apiKey" placeholder="AIza..." value="">
        
        <label>ëª¨ë¸ ì„ íƒ:</label>
        <select id="modelSelect" style="width:100%; padding:8px; margin-bottom: 10px;">
            <option value="gemini-1.5-flash">gemini-1.5-flash (í‘œì¤€)</option>
            <option value="gemini-3-pro-image-preview">gemini-3-pro-image-preview (ì‚¬ìš©ì ë°œê²¬)</option>
            <option value="gemini-1.5-pro">gemini-1.5-pro (ê³ ì„±ëŠ¥)</option>
        </select>

        <label>ì´ë¯¸ì§€ ì„ íƒ (1ì¥):</label>
        <input type="file" id="fileInput" accept="image/*">
        <div id="previewContainer"></div>

        <button onclick="analyzeImage()">ë¶„ì„ ì‹œì‘ ğŸš€</button>
    </div>

    <div class="box">
        <h3>ë¶„ì„ ê²°ê³¼:</h3>
        <div id="result">ê²°ê³¼ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤...</div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // Image Preview
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewContainer').innerHTML = `<img src="${e.target.result}" style="max-height: 200px;">`;
                }
                reader.readAsDataURL(file);
            }
        });

        window.analyzeImage = async function() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const modelName = document.getElementById('modelSelect').value;
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('result');

            if (!apiKey) {
                alert('API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            if (fileInput.files.length === 0) {
                alert('ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            resultDiv.innerText = "â³ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.";

            try {
                const genAI = new GoogleGenerativeAI(apiKey);
                const model = genAI.getGenerativeModel({ model: modelName });

                const file = fileInput.files[0];
                const base64Data = await fileToGenerativePart(file);

                const prompt = `
                ì´ ì‚¬ì§„ì€ í•œêµ­ì˜ ì¥ì‚¬ì‹œì„¤(ì¥ë¡€ì‹ì¥, ë¬˜ì§€ ë“±)ì…ë‹ˆë‹¤.
                ì‚¬ì§„ì„ ë³´ê³  ë‹¤ìŒ ì¤‘ ì–´ë–¤ ìœ í˜•ì¸ì§€ í•˜ë‚˜ë§Œ ê³¨ë¼ì£¼ì„¸ìš”:
                - "ê³µì›ë¬˜ì§€" (ì•¼ì™¸ ë§¤ì¥ë¬˜)
                - "ë´‰ì•ˆë‹¹" (ì‹¤ë‚´ ë‚©ê³¨ë‹¹)
                - "ìˆ˜ëª©ì¥" (ìì—°ì¥/ë‚˜ë¬´)
                - "ë³µí•©" (ì—¬ëŸ¬ ìœ í˜• í˜¼í•©)

                ë‹µë³€ í˜•ì‹: "ìœ í˜•: [ìœ í˜•ì´ë¦„]\nì´ìœ : [ê°„ë‹¨í•œ ì´ìœ ]"
                `;

                const result = await model.generateContent([prompt, base64Data]);
                const response = await result.response;
                const text = response.text();

                resultDiv.innerText = text;

            } catch (error) {
                console.error(error);
                resultDiv.innerText = "âŒ ì—ëŸ¬ ë°œìƒ:\n" + error.message;
            }
        };

        async function fileToGenerativePart(file) {
            const base64EncodedDataPromise = new Promise((resolve) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result.split(',')[1]);
                reader.readAsDataURL(file);
            });
            return {
                inlineData: { data: await base64EncodedDataPromise, mimeType: file.type },
            };
        }
    </script>
</body>
</html>
